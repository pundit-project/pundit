<?xml version='1.0' encoding='UTF-8'?>
<jdbc version="1">
    <connections>
        <connection name="mariadb" jdbcUrl="jdbc:mariadb://pundit.aglt2.org/pythia_new?user=punditui&amp;password=kdnr93y7j6b3#9fgT"/>
    </connections>
    
     <channels pollInterval="30">
        <channelSet connectionName="mariadb">
            <channel name="test/now">
                <query>SELECT NOW() AS CurrentTime</query>
                <pollQuery>SELECT NOW()</pollQuery>
            </channel>
        </channelSet>

        <channelSet connectionName="mariadb">
            <channel name="history/traceroute/(.*)/(.*)">
                <query>SELECT tracerouteHistory.timestamp, tracerouteHistory.tracerouteId FROM tracerouteHistory, traceroute, host AS src, host AS dst WHERE tracerouteHistory.tracerouteID = traceroute.tracerouteID AND traceroute.srcID = src.hostId AND src.name = ? AND traceroute.dstID = dst.hostId AND dst.name = ? LIMIT 50</query>
                <pollQuery>SELECT tracerouteHistory.timestamp FROM tracerouteHistory, traceroute, host AS src, host AS dst WHERE tracerouteHistory.tracerouteID = traceroute.tracerouteID AND traceroute.srcID = src.hostId AND src.name = ? AND traceroute.dstID = dst.hostId AND dst.name = ? LIMIT 1</pollQuery>
            </channel>
            <channel name="traceroute/(.*)">
                <query>SELECT tracehop.hopNumber, hop.ip, hop.name FROM tracehop, hop WHERE tracehop.tracerouteId = ? AND tracehop.nodeId = hop.hopId</query>
                <pollQuery>SELECT ?</pollQuery>
            </channel>
            <channel name="hosts">
                <query>SELECT name FROM host ORDER BY name;</query>
                <pollQuery>SELECT COUNT(*) FROM host</pollQuery>
            </channel>
            <channel name="report/(.*)/(.*)">
                <query>SELECT startTime AS Start, endTime as End, src.name AS Source, dst.name AS Dest, type AS Type, info AS Info FROM problem, host AS src, host AS dst WHERE problem.srcId = src.hostId AND problem.dstId = dst.hostId AND (src.site = ? OR dst.site = ?)</query>
                 <pollQuery>SELECT UNIX_TIMESTAMP(MAX(COALESCE(endTime,startTime))) FROM problem, host AS src, host AS dst WHERE problem.srcId = src.hostId AND problem.dstId = dst.hostId AND (src.site = ? OR dst.site = ?)</pollQuery>
                 <!--<pollQuery>SELECT NOW()</pollQuery>-->
            </channel>
            <channel name="problems/count/(.*)/(.*)">
                <query>SELECT timeBlock AS Time, SUM(hasDelay) AS delay, SUM(hasLoss) AS loss FROM timeSeries, host AS src, host AS dst WHERE srcId = src.hostId AND dstId = dst.hostId AND (src.site=? OR dst.site=?) GROUP BY timeBlock</query>
                <pollQuery>SELECT timeBlock FROM timeSeries, host AS src, host AS dst WHERE srcId = src.hostId AND dstId = dst.hostId AND (src.site=? OR dst.site=?) LIMIT 1</pollQuery>
            </channel>
            <channel name="history/info/(.*)/(.*)/delay">
                <query>SELECT timeBlock AS Time, delay AS Delay FROM timeSeries, host AS src, host AS dst WHERE srcId = src.hostId AND dstId = dst.hostId AND src.name=? AND dst.name=? ORDER BY timeBlock ASC;</query>
                <pollQuery>SELECT timeBlock AS Time FROM timeSeries, host AS src, host AS dst WHERE srcId = src.hostId AND dstId = dst.hostId AND src.name=? AND dst.name=? ORDER BY timeBlock ASC LIMIT 1</pollQuery>
            </channel>
            <channel name="history/info/(.*)/(.*)/pLoss">
                <query>SELECT timeBlock AS Time, loss AS Loss FROM timeSeries, host AS src, host AS dst WHERE srcId = src.hostId AND dstId = dst.hostId AND src.name=? AND dst.name=? ORDER BY timeBlock ASC;</query>
                <pollQuery>SELECT timeBlock AS Time FROM timeSeries, host AS src, host AS dst WHERE srcId = src.hostId AND dstId = dst.hostId AND src.name=? AND dst.name=? ORDER BY timeBlock ASC LIMIT 1</pollQuery>
            </channel>
        </channelSet>

    </channels>
</jdbc>
